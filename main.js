"use strict";function createTray(){const e=join(__dirname,"static/light.png");_tray=new Tray(e),_tray.setToolTip("SilentShot | click to capture"),_tray.on("click",()=>{let e=`${settings.defaultDir}/Downloads/capture${Date.now()}.${settings.format}`;settings.saveToFolder?screenshot({filename:e}).then(e=>{console.log("Copied to clipboard and saved to device!"),settings.copyToClipBoard&&clipboard.writeImage(e)}):screenshot().then(e=>{console.log("Copied to clipboard"),clipboard.writeImage(e)})}),_tray.on("right-click",()=>{const e=[{label:"save options",submenu:[{accelerator:"darwin"===process.platform?"Alt+Cmd+L":"Alt+Ctrl+L",label:"Save to folder",type:"checkbox",click:()=>{saveToFolder=!saveToFolder,copyToClipBoard||(copyToClipBoard=!0)},checked:saveToFolder},{label:"Copy to clipboard",type:"checkbox",click:()=>{copyToClipBoard=!copyToClipBoard,console.log(copyToClipBoard)},checked:copyToClipBoard}]},{label:"change default directory",click:()=>{dialog.showOpenDialog({properties:["openDirectory"]}).then(e=>{settings.defaultDir=e.filePaths[0]})}},{label:"About Silentshot",click:()=>{shell.openExternal("https://silentshot.achuth.dev")}},{role:"quit",accelerator:(process.platform,"Alt+Shift+L")}],o=Menu.buildFromTemplate(e);_tray.popUpContextMenu(o)})}function createBrowserWindow(){browserWindow=new BrowserWindow({icon:join("./static/icon.png"),frame:!1,height:300,width:300,resizable:!1,alwaysOnTop:!0,skipTaskbar:!0,webPreferences:{nodeIntegration:!0,contextIsolation:!1}}),browserWindow.loadFile("./static/index.html")}const{app:app,Tray:Tray,clipboard:clipboard,Menu:Menu,dialog:dialog,shell:shell,BrowserWindow:BrowserWindow,ipcMain:ipcMain}=require("electron"),{join:join}=require("path"),screenshot=require("screenshot-desktop"),{homedir:homedir}=require("os"),{onFirstRunMaybe:onFirstRunMaybe}=require("./first-run"),Store=require("electron-store");let _tray,browserWindow,store=new Store,user={isVerified:!1},settings={format:"png",defaultDir:homedir,savetoClipboard:!0,saveToDevice:!0};store.get("user-info")&&(user=store.get("user-info")),store.get("silentshot")?settings=store.get("silentshot"):store.set("silentshot",settings);let saveToFolder=!0,copyToClipBoard=!0;app.dock&&app.dock.hide(),app.on("ready",async()=>{if(await onFirstRunMaybe(),!user.isVerified)return user.isVerified?(settings.autolaunch?autoLauncher.enable():autoLauncher.disable(),createTray(),void createGlobalshortcuts()):void createBrowserWindow()}),ipcMain.on("verified",(e,{id:o,name:r})=>{e.returnValue="Verified",user.id=o,user.name=r,user.isVerified=!0,store.set("user-info",user),browserWindow.hide(),createTray()}),ipcMain.on("quit",()=>{app.quit()});
