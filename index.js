"use strict";function UpdateSettings(e){e.autolaunch?autoLauncher.enable():autoLauncher.disable(),settings=e,store.set("silentshot",e)}function createGlobalshortcuts(){const e=globalShortcut.register("Command+Alt+S",clickTray);e||console.log("registration failed"),console.log(globalShortcut.isRegistered("Command+Alt+S"))}function clickTray(){let e=`${settings.defaultDir}/capture${Date.now()}.${settings.format}`;if(settings.saveToDevice)screenshot({filename:e}).then(e=>{console.log("Copied to clipboard and saved to device!"),settings.savetoClipboard&&(console.log(e),clipboard.writeImage(e))});else{let e=`${tmpdir()}/capture${Date.now()}.${settings.format}`;screenshot({format:settings.format,filename:e}).then(e=>{console.log("copied to clipboard"),clipboard.writeImage(e)})}}function RighClickTray(){const e=[{label:"Save options",submenu:[{accelerator:"darwin"===process.platform?"Alt+Cmd+L":"Alt+Ctrl+L",label:"Save to folder",type:"checkbox",click:()=>{settings.saveToDevice=!settings.saveToDevice,settings.savetoClipboard||(settings.savetoClipboard=!0),UpdateSettings(settings)},checked:settings.saveToDevice},{label:"Copy to clipboard",type:"checkbox",click:()=>{settings.saveToDevice||(settings.saveToDevice=!0),settings.savetoClipboard=!settings.savetoClipboard,UpdateSettings(settings)},checked:settings.savetoClipboard}]},{label:"Image format",submenu:[{label:"png",type:"checkbox",checked:"png"===settings.format,click:()=>{settings.format="png",UpdateSettings(settings)}},{label:"jpg",type:"checkbox",checked:"jpg"===settings.format,click:()=>{settings.format="jpg",UpdateSettings(settings)}}]},{label:"Change default directory",click:()=>{dialog.showOpenDialog({properties:["openDirectory"]}).then(e=>{settings.defaultDir=e.filePaths[0],UpdateSettings(settings)})}},{label:"Autolaunch",type:"checkbox",click:()=>{settings.autolaunch=!settings.autolaunch,UpdateSettings(settings)},checked:settings.autolaunch},{label:"About Silentshot",click:()=>{shell.openExternal("https://silentshot.achuth.dev")}},{role:"quit",accelerator:(process.platform,"Alt+Shift+L")}],t=Menu.buildFromTemplate(e);_tray.popUpContextMenu(t)}function createTray(){const e=join(__dirname,"lightTemplate.png");_tray=new Tray(e),_tray.setToolTip("SilentShot | click to capture"),_tray.on("click",clickTray),_tray.on("right-click",RighClickTray)}const{app:app,Tray:Tray,clipboard:clipboard,Menu:Menu,dialog:dialog,shell:shell,ipcMain:ipcMain,globalShortcut:globalShortcut}=require("electron"),{join:join}=require("path"),screenshot=require("screenshot-desktop"),{homedir:homedir,tmpdir:tmpdir}=require("os"),Store=require("electron-store"),AutoLaunch=require("auto-launch"),autoLauncher=new AutoLaunch({name:"Silentshot",path:"/Applications/silentshot.app"});let _tray,browserWindow,store=new Store,user={isVerified:!1},settings={format:"png",defaultDir:`${homedir()}/Downloads`,savetoClipboard:!0,saveToDevice:!0,autolaunch:!0};store.get("user-info")&&(user=store.get("user-info")),store.get("silentshot")?settings=store.get("silentshot"):store.set("silentshot",settings),app.dock&&app.dock.hide(),app.on("ready",async()=>{settings.autolaunch?autoLauncher.enable():autoLauncher.disable(),createTray(),createGlobalshortcuts()}),app.on("will-quit",()=>{globalShortcut.unregisterAll()}),ipcMain.on("verified",(e,{id:t,name:o})=>{e.returnValue="Verified",user.id=t,user.name=o,user.isVerified=!0,store.set("user-info",user),browserWindow.hide(),createTray()}),ipcMain.on("quit",()=>{app.quit()});